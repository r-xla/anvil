<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>JIT compile a function — jit • anvil</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="JIT compile a function — jit"><meta name="description" content="Wraps a function so that it is traced, lowered to StableHLO, and compiled to an XLA
executable on first call. Subsequent calls with the same input shapes and dtypes hit an
LRU cache and skip recompilation. Unlike xla(), the compiled executable is not
created eagerly but lazily on the first invocation."><meta property="og:description" content="Wraps a function so that it is traced, lowered to StableHLO, and compiled to an XLA
executable on first call. Subsequent calls with the same input shapes and dtypes hit an
LRU cache and skip recompilation. Unlike xla(), the compiled executable is not
created eagerly but lazily on the first invocation."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">anvil</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/anvil.html">Get Started</a></li>
    <li><a class="dropdown-item" href="../articles/type-promotion.html">Type Promotion</a></li>
    <li><a class="dropdown-item" href="../articles/subsetting.html">Subsetting</a></li>
    <li><a class="dropdown-item" href="../articles/random-numbers.html">Random Number Generation</a></li>
    <li><a class="dropdown-item" href="../articles/debugging.html">Debugging</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples"><li><a class="dropdown-item" href="../articles/logistic-regression.html">Logistic Regression</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical"><li><a class="dropdown-item" href="../articles/internals.html">Internals</a></li>
    <li><a class="dropdown-item" href="../articles/primitives.html">Primitives Overview</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending</h6></li>
    <li><a class="dropdown-item" href="../articles/contributing.html">Adding a Primitive</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-xla/anvil/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>JIT compile a function</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-xla/anvil/blob/main/R/jit.R" class="external-link"><code>R/jit.R</code></a></small>
      <div class="d-none name"><code>jit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Wraps a function so that it is traced, lowered to StableHLO, and compiled to an XLA
executable on first call. Subsequent calls with the same input shapes and dtypes hit an
LRU cache and skip recompilation. Unlike <code><a href="xla.html">xla()</a></code>, the compiled executable is not
created eagerly but lazily on the first invocation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">jit</span><span class="op">(</span></span>
<span>  <span class="va">f</span>,</span>
<span>  static <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cache_size <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>  donate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  device <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>(<code>function</code>)<br>
Function to compile. Must accept and return <code><a href="AnvilTensor.html">AnvilTensor</a></code>s (and/or
static arguments).</p></dd>


<dt id="arg-static">static<a class="anchor" aria-label="anchor" href="#arg-static"></a></dt>
<dd><p>(<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code>)<br>
Names of parameters of <code>f</code> that are <em>not</em> tensors. Static values are
embedded as constants in the compiled program; a new compilation is triggered whenever
a static value changes. For example useful when you want R control flow in your function.</p></dd>


<dt id="arg-cache-size">cache_size<a class="anchor" aria-label="anchor" href="#arg-cache-size"></a></dt>
<dd><p>(<code>integer(1)</code>)<br>
Maximum number of compiled executables to keep in the LRU cache.</p></dd>


<dt id="arg-donate">donate<a class="anchor" aria-label="anchor" href="#arg-donate"></a></dt>
<dd><p>(<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code>)<br>
Names of the arguments whose buffers should be donated.
Donated buffers can be aliased with outputs of the same type,
allowing in-place operations and reducing memory usage.
An argument cannot appear in both <code>donate</code> and <code>static</code>.</p></dd>


<dt id="arg-device">device<a class="anchor" aria-label="anchor" href="#arg-device"></a></dt>
<dd><p>(<code>NULL</code> | <code>character(1)</code> | <code><a href="https://r-xla.github.io/pjrt/reference/pjrt_device.html" class="external-link">PJRTDevice</a></code>)<br>
The device to use if it cannot be inferred from the inputs or constants.
Defaults to <code>"cpu"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>JitFunction</code> with the same formals as <code>f</code>.</p>
<p>(<code>function</code>)</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="xla.html">xla()</a></code> for ahead-of-time compilation, <code><a href="jit_eval.html">jit_eval()</a></code> for evaluating an expression once.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu">jit</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">f</span><span class="op">(</span><span class="fu"><a href="AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AnvilTensor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [ CPUf32{1} ] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Static arguments enable data-dependent control flow</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">jit</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">flag</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">flag</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span> <span class="kw">else</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">}</span>, static <span class="op">=</span> <span class="st">"flag"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">g</span><span class="op">(</span><span class="fu"><a href="AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AnvilTensor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [ CPUf32{1} ] </span>
<span class="r-in"><span><span class="fu">g</span><span class="op">(</span><span class="fu"><a href="AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>, <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AnvilTensor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [ CPUf32{1} ] </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Fischer, Daniel Falbel, Nikolai German.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

