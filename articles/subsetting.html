<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Subsetting • anvil</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Subsetting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">anvil</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/anvil.html">Get Started</a></li>
    <li><a class="dropdown-item" href="../articles/type-promotion.html">Type Promotion</a></li>
    <li><a class="dropdown-item" href="../articles/subsetting.html">Subsetting</a></li>
    <li><a class="dropdown-item" href="../articles/random-numbers.html">Random Number Generation</a></li>
    <li><a class="dropdown-item" href="../articles/debugging.html">Debugging</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples">
<li><a class="dropdown-item" href="../articles/logistic-regression.html">Logistic Regression</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical">
<li><a class="dropdown-item" href="../articles/internals.html">Internals</a></li>
    <li><a class="dropdown-item" href="../articles/primitives.html">Primitives Overview</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending</h6></li>
    <li><a class="dropdown-item" href="../articles/contributing.html">Adding a Primitive</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-xla/anvil/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Subsetting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-xla/anvil/blob/v0.1.0/vignettes/subsetting.Rmd" class="external-link"><code>vignettes/subsetting.Rmd</code></a></small>
      <div class="d-none name"><code>subsetting.Rmd</code></div>
    </div>

    
    
<p>In this vignette, you will learn how to subset tensors in {anvil} and
how to update subsets. Because tensor shapes in {anvil} programs are
static, only certain subsetting operations are supported and they come
with some surprises.</p>
<p>We start by listing possible subsets and whether they support dynamic
values (tensors that are specified during runtime) or only static values
(e.g., R literals).</p>
<table class="table">
<thead><tr class="header">
<th>Subset</th>
<th>Dynamic</th>
<th>Static</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Single Index</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Multiple Indices</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td>Range</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Mask</td>
<td>No</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>Ranges cannot have dynamic values, because then the size of the
subset would be unknown (what’s the size of <code>a:b</code> where
<code>a</code> and <code>b</code> are unknown?). Boolean masks are not
supported, because the output shape depends on the data, which is not
known at compile time. If you want to modify tensors based on a mask,
see <code><a href="../reference/nv_ifelse.html">nv_ifelse()</a></code>. Negative indexing (e.g.,
<code>x[-1]</code> to exclude elements) is currently also not supported.
For static values, this will throw an error, for dynamic values, it will
be clamped to the valid range. If you are missing a feature, please open
an issue on GitHub.</p>
<p>We will start with subsetting and then move on to
subset-assignment.</p>
<div class="section level2">
<h2 id="subsetting">Subsetting<a class="anchor" aria-label="anchor" href="#subsetting"></a>
</h2>
<div class="section level3">
<h3 id="subsetting-1d-tensors">Subsetting 1D tensors<a class="anchor" aria-label="anchor" href="#subsetting-1d-tensors"></a>
</h3>
<p>Let’s start with some simple examples of selecting individual
elements from a 1-dimension tensor. The index can be either static or
dynamic and we can drop or keep the dimension:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-xla.github.io/anvil/">anvil</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##   1</span></span>
<span><span class="co">##   2</span></span>
<span><span class="co">##   3</span></span>
<span><span class="co">##   4</span></span>
<span><span class="co">##   5</span></span>
<span><span class="co">##   6</span></span>
<span><span class="co">##   7</span></span>
<span><span class="co">##   8</span></span>
<span><span class="co">##   9</span></span>
<span><span class="co">##  10</span></span>
<span><span class="co">## [ CPUi32{10} ]</span></span></code></pre>
<ul>
<li>
<p>Static &amp; Drop:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2</span></span>
<span><span class="co">## [ CPUi32{} ]</span></span></code></pre>
</li>
<li>
<p>Static &amp; Keep:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2</span></span>
<span><span class="co">## [ CPUi32{1} ]</span></span></code></pre>
</li>
<li>
<p>Dynamic &amp; Drop:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="../reference/AnvilTensor.html">nv_scalar</a></span><span class="op">(</span><span class="fl">2L</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2</span></span>
<span><span class="co">## [ CPUi32{} ]</span></span></code></pre>
</li>
<li>
<p>Dynamic &amp; Keep:</p>
<p>Below, we almost perform the same operation as above, only do we use
a tensor of shape <code>(1)</code> instead of a scalar with shape
<code>()</code>. The difference is that subsetting with the former will
preserve the dimension, while the latter will drop it, as we have seen
above. This ensures that the dimensionality of the result is the same
for any 1D subset specification, and not suddenly “simplify” the result
to 0D.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fl">2L</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2</span></span>
<span><span class="co">## [ CPUi32{1} ]</span></span></code></pre>
</li>
</ul>
<p>Next, we subset multiple elements, where we only have to distinguish
between static and dynamic indices.</p>
<ul>
<li>
<p>Static</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2</span></span>
<span><span class="co">##  4</span></span>
<span><span class="co">##  6</span></span>
<span><span class="co">## [ CPUi32{3} ]</span></span></code></pre>
</li>
<li>
<p>Dynamic</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">4L</span>, <span class="fl">6L</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2</span></span>
<span><span class="co">##  4</span></span>
<span><span class="co">##  6</span></span>
<span><span class="co">## [ CPUi32{3} ]</span></span></code></pre>
</li>
</ul>
<p>We are using <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> instead of 1-dimension vectors,
because otherwise the case where we use a length-1 vector would be
ambiguous (do we drop or keep the dimension?). This allows us to do
without a <code>drop</code> parameter.</p>
<p>We can also use a range that can be specified either canonically via
<code>a:b</code> or using <code><a href="../reference/nv_seq.html">nv_seq()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2</span></span>
<span><span class="co">##  3</span></span>
<span><span class="co">##  4</span></span>
<span><span class="co">##  5</span></span>
<span><span class="co">## [ CPUi32{4} ]</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="../reference/nv_seq.html">nv_seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2</span></span>
<span><span class="co">##  3</span></span>
<span><span class="co">##  4</span></span>
<span><span class="co">##  5</span></span>
<span><span class="co">## [ CPUi32{4} ]</span></span></code></pre>
<p>Note that the <code>a:b</code> syntax works via
Non-Standard-Evaluation (NSE), so we can distinguish it from the actual
vector <code>2:5</code>. Internally, it is translated to
<code>nv_seq(a, b)</code>.</p>
<p>It is also possible to select the whole range by omitting the
specification altogether.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##   1</span></span>
<span><span class="co">##   2</span></span>
<span><span class="co">##   3</span></span>
<span><span class="co">##   4</span></span>
<span><span class="co">##   5</span></span>
<span><span class="co">##   6</span></span>
<span><span class="co">##   7</span></span>
<span><span class="co">##   8</span></span>
<span><span class="co">##   9</span></span>
<span><span class="co">##  10</span></span>
<span><span class="co">## [ CPUi32{10} ]</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="subsetting-higher-dimensional-tensors">Subsetting higher-dimensional tensors<a class="anchor" aria-label="anchor" href="#subsetting-higher-dimensional-tensors"></a>
</h3>
<p>We start by creating a 2-dimensional tensor.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##   1  2  3  4</span></span>
<span><span class="co">##   5  6  7  8</span></span>
<span><span class="co">##   9 10 11 12</span></span>
<span><span class="co">## [ CPUi32{3,4} ]</span></span></code></pre>
<p>Combining subsets just works like one would expect.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">##  2</span></span>
<span><span class="co">##  3</span></span>
<span><span class="co">##  4</span></span>
<span><span class="co">## [ CPUi32{4} ]</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2</span></span>
<span><span class="co">## [ CPUi32{} ]</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2 3</span></span>
<span><span class="co">## [ CPUi32{1,2} ]</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##   2  3</span></span>
<span><span class="co">##  10 11</span></span>
<span><span class="co">## [ CPUi32{2,2} ]</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2 3</span></span>
<span><span class="co">##  6 7</span></span>
<span><span class="co">## [ CPUi32{2,2} ]</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  2</span></span>
<span><span class="co">##  3</span></span>
<span><span class="co">## [ CPUi32{2} ]</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  5 6 7 8</span></span>
<span><span class="co">##  5 6 7 8</span></span>
<span><span class="co">## [ CPUi32{2,4} ]</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  5 6 7 8</span></span>
<span><span class="co">##  5 6 7 8</span></span>
<span><span class="co">## [ CPUi32{2,4} ]</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="out-of-bounds-handling">Out-of-bounds Handling<a class="anchor" aria-label="anchor" href="#out-of-bounds-handling"></a>
</h3>
<p>If one specifies out-of-bounds indices, we can only throw an error if
the indices are static (we know them at compile time), as the XLA
backend that {anvil} compiles to, does not throw errors when using
out-of-bounds indices, but instead clamps them to the valid range:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1L</span><span class="op">)</span>, <span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fl">100L</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  4</span></span>
<span><span class="co">## [ CPUi32{1,1} ]</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span>, <span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fl">4L</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  4</span></span>
<span><span class="co">## [ CPUi32{1,1} ]</span></span></code></pre>
<p>Therefore, you need to be careful when using dynamic indexing in
order to avoid bugs.</p>
</div>
</div>
<div class="section level2">
<h2 id="updating-subsets">Updating Subsets<a class="anchor" aria-label="anchor" href="#updating-subsets"></a>
</h2>
<p>Updating subsets supports the same syntax as subsetting. The value to
write must either have the shape of the subset, or be a scalar.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##   1  2  3  4</span></span>
<span><span class="co">##   5  6  7  8</span></span>
<span><span class="co">##   9 10 11 12</span></span>
<span><span class="co">## [ CPUi32{3,4} ]</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##   1  2 -1  4</span></span>
<span><span class="co">##   5  6 -2  8</span></span>
<span><span class="co">##   9 10 -3 12</span></span>
<span><span class="co">## [ CPUi32{3,4} ]</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">99L</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##    1   2 -99   4</span></span>
<span><span class="co">##    5   6 -99   8</span></span>
<span><span class="co">##    9  10 -99  12</span></span>
<span><span class="co">## [ CPUi32{3,4} ]</span></span></code></pre>
<p>Also, it must have a data type that is convertible to the data type
of the tensor.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `nv_subset_assign()`:</span></span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> Value type f32 is not promotable to left-hand side type i32</span></span></code></pre>
<div class="section level3">
<h3 id="out-of-bounds-handling-1">Out-of-bounds Handling<a class="anchor" aria-label="anchor" href="#out-of-bounds-handling-1"></a>
</h3>
<p>Similar to subsetting, out-of-bounds indices can only be checked for
static values. For dynamic indices, out-of-bounds writes are simply
ignored:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">100L</span>, <span class="fl">3L</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1L</span>, <span class="op">-</span><span class="fl">2L</span>, <span class="op">-</span><span class="fl">3L</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  -1</span></span>
<span><span class="co">##   2</span></span>
<span><span class="co">##  -3</span></span>
<span><span class="co">##   4</span></span>
<span><span class="co">##   5</span></span>
<span><span class="co">## [ CPUi32{5} ]</span></span></code></pre>
<p>Here, the write to index 100 is silently ignored, while indices 1 and
3 are updated.</p>
</div>
<div class="section level3">
<h3 id="duplicate-indices">Duplicate Indices<a class="anchor" aria-label="anchor" href="#duplicate-indices"></a>
</h3>
<p>When writing to the same element multiple times, there is no
gaurantee which value will be written. Specifically, this might differ
between backends (CPU vs. GPU).</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/jit_eval.html">jit_eval</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AnvilTensor.html">nv_tensor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10L</span>, <span class="fl">20L</span>, <span class="fl">30L</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor</span></span>
<span><span class="co">##  30</span></span>
<span><span class="co">##   2</span></span>
<span><span class="co">##   3</span></span>
<span><span class="co">##   4</span></span>
<span><span class="co">##   5</span></span>
<span><span class="co">## [ CPUi32{5} ]</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Fischer, Daniel Falbel, Nikolai German.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
