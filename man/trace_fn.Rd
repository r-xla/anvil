% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/graph.R
\name{trace_fn}
\alias{trace_fn}
\title{Trace an R function into a Graph}
\usage{
trace_fn(
  f,
  args = NULL,
  desc = NULL,
  toplevel = FALSE,
  lit_to_tensor = FALSE,
  args_flat = NULL,
  in_tree = NULL
)
}
\arguments{
\item{f}{(\code{function})\cr
The function to trace. Must not be a \code{JitFunction} (i.e. already jitted).}

\item{args}{(\code{list} of (\code{\link{AnvilTensor}} | \code{\link{AbstractTensor}}))\cr
The (unflattened) arguments to the function. Mutually exclusive with the
\code{args_flat}/\code{in_tree} pair.}

\item{desc}{(\code{NULL} | \code{GraphDescriptor})\cr
Optional descriptor. When \code{NULL} (default), a new descriptor is created.}

\item{toplevel}{(\code{logical(1)})\cr
If \code{TRUE}, concrete \code{\link{AnvilTensor}} inputs are treated as unknown (traced) values.
If \code{FALSE} (default), they are treated as known constants.}

\item{lit_to_tensor}{(\code{logical(1)})\cr
Whether to convert literal inputs to tensors. Used internally by higher-order
primitives such as \code{nv_if} and \code{nv_while}.}

\item{args_flat}{(\code{list})\cr
Flattened arguments. Must be accompanied by \code{in_tree}.}

\item{in_tree}{(\code{Node})\cr
Tree structure describing how \code{args_flat} maps back to \code{f}'s arguments.}
}
\value{
An \code{\link{AnvilGraph}} containing the traced operations.
}
\description{
Executes \code{f} with abstract tensor arguments and records every primitive operation into
an \code{\link{AnvilGraph}}.

The resulting graph can be lowered to StableHLO (via \code{\link[=stablehlo]{stablehlo()}}) or transformed
(e.g. via \code{\link[=transform_gradient]{transform_gradient()}}).
}
\examples{
\dontshow{if (pjrt::plugin_is_downloaded()) withAutoprint(\{ # examplesIf}
graph <- trace_fn(function(x, y) x + y,
  args = list(x = nv_tensor(1, dtype = "f32"), y = nv_tensor(2, dtype = "f32"))
)
graph
\dontshow{\}) # examplesIf}
}
\seealso{
\code{\link[=stablehlo]{stablehlo()}} to lower the graph, \code{\link[=jit]{jit()}} / \code{\link[=xla]{xla()}} for end-to-end
compilation.
}
